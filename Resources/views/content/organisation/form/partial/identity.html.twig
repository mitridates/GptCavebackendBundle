{#
/**
 * @file identity.html.twig
 * @parent ../edit.html.twig
 */
#}
{% set country_attr= {attr: {'data-child': '#'~form.admin1.vars.id}} %}

{% set admin1_attr= {attr: {
    'data-child': '#'~form.admin2.vars.id,
    'data-url': path('cave_backend_json_admin1'),
    'data-parentid': 'countryid',
    'data-placeholder': 'select.government.level.admin1'|trans({},'cavemessages')|raw,
}}%}

{% set admin2_attr= {attr: {
    'data-child': '#'~form.admin3.vars.id,
    'data-url': path('cave_backend_json_admin2'),
    'data-parentid': 'admin1id',
    'data-placeholder': 'select.government.level.admin2'|trans({},'cavemessages')|raw
}}%}

{% set admin3_attr= {attr: {
    'data-url': path('cave_backend_json_admin3'),
    'data-parentid': 'admin2id',
    'data-placeholder': 'select.government.level.admin3'|trans({},'cavemessages')|raw,
}}%}
{% embed '@GptCavebackend/partial/page/panel.html.twig' with {type: arrayParams.page.style.form_panel }%}
    {% block heading %}{{ 'organisation.edit.form.identity'|trans({},'cavepages')|raw -}}{% endblock heading %}
    {% block body %}
{# Organisation name, code, id, initials #}
<table class="table">
 <tr>
      <td>{{ form_label(form.code)}}</td>
      <td>{{ form_label(form.name)}}</td>
      <td>{{ form_label(form.initials)}}</td>
      <td></td>
    </tr>
    <tr>
      <td>{{ form_widget(form.code) }}</td>
      <td>{{ form_widget(form.name) }}</td>
      <td>{{ form_widget(form.initials) }}</td>
      <td>{{ form_widget(form.idgenerator) }}</td>
</tr>
</table>
        <script>
            $(document).ready(function() {
                let repo = new Repopulate( '#{{ form.country.vars.id }}');
                repo.on('ev.onLoadResponse', (data, el, attr)=>{
                    return JSON.parse(data.response).out;//data is in 'out' array
                });
                repo.bindAll();
            });
        </script>
{# Org country, state #}
<table class="table">
    <tr>
      <td>{{ form_label(form.country)}}</td>
      <td>{{ form_label(form.admin1)}}</td>
      <td>{{ form_label(form.admin2)}}</td>
      <td>{{ form_label(form.admin3)}}</td>
    </tr>

    <tr>
        <td>{{ form_widget(form.country, country_attr) }}</td>
        <td>{{ form_widget(form.admin1, admin1_attr) }}</td>
        <td>{{ form_widget(form.admin2, admin2_attr) }}</td>
        <td>{{ form_widget(form.admin3, admin3_attr) }}</td>
    </tr>
</table>
{% endblock body %}
{% endembed %}
